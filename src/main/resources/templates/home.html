<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

    <!--    Important: Known issues with this dialog/page
            Thymeleaf + Bootstraps + DataTables is unstable. According to several forums and my own experience this issues can be solved
            but it would potentially take a lot of time and in depth knowledge of javascript and the frameworks. Therefore I used several
            workarounds which I found during many hours of trying.

            1)  The javascript and stylesheet components are loaded in the head without Thymeleaf fragments. Using Thymeleaf fragments
                to load the javascript/stylesheet dependencies breaks DataTables.

            2)  DataTables don`t go well with Bootstraps dropdown menus. Therefore the navbar was changed to not include any dropdown menu.
                It is also not (easily) possible to use any dropdown menu on a page which uses DataTables. Therefore I designed the page without
                dropdown menus.

            3)  DataTables don`t go well with Bootstraps aria-labels/data-dismiss. Therefore the aria-label/data-dismiss is not working properly. I used a real
                link to reload the page instead of a javascript event to close the respective element.
    -->

    <head>
        <title>SalesWebApp Home</title>

        <!-- Know issue: Number 1 -->
        <script type="text/javascript" th:src="@{webjars/bootstrap/3.3.7/js/bootstrap.min.js}" />
        <script type="text/javascript" th:src="@{webjars/jquery/3.2.1/jquery.min.js}" />
        <script type="text/javascript" th:src="@{https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js}" />
        <link rel="stylesheet" type="text/css" th:href="@{webjars/bootstrap/3.3.7/css/bootstrap.min.css}" />
        <link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css" />
        <link rel="stylesheet" type="text/css" th:href="@{/css/main.css}" />

        <script th:inline="none">
            $(document).ready(function(){
                $('#restaurantTable').DataTable({});
                $('#toDoTable').DataTable({});
            });
        </script>
    </head>

    <body>
        <div th:replace="fragments/navbarHome :: navbarHome"></div>

        <div class="container">
            <!--    Shows the status of the last transaction.
                    Known issue: Number 3 -->
            <div style="width: 75%">
                <div th:if="${param.profileChangeSuccess != null}" class="alert alert-success">
                    <a href="/saleswebapp/home" class="close" data-dismiss="alert" aria-label="close" title="close">x</a>
                    <th th:text="#{home.success.profileChangeSuccess}" />
                </div>

                <div th:if="${param.profileWasChangedMeanwhile != null}" class="alert alert-danger">
                    <a href="/saleswebapp/home" class="close" data-dismiss="alert" aria-label="close" title="close">x</a>
                    <th th:text="#{home.error.profileWasChangedMeanwhile}" />
                </div>

                <div th:if="${param.noValidAccessToRestaurant != null}" class="alert alert-danger">
                    <a href="/saleswebapp/home" class="close" data-dismiss="alert" aria-label="close" title="close">x</a>
                    <th th:text="#{home.error.noValidAccessToRestaurant}" />
                </div>

                <div th:if="${param.newRestaurantAddedSuccessfully != null}" class="alert alert-success">
                    <a href="/saleswebapp/home" class="close" data-dismiss="alert" aria-label="close" title="close">x</a>
                    <th th:text="#{home.success.newRestaurantAddedSuccessfully}" />
                </div>

                <div th:if="${param.restaurantWasChangedMeanwhile != null}" class="alert alert-danger">
                    <a href="/saleswebapp/home" class="close" data-dismiss="alert" aria-label="close" title="close">x</a>
                    <th th:text="#{home.error.restaurantWasChangedMeanwhile}" />
                </div>

                <div th:if="${param.restaurantChangeSuccess != null}" class="alert alert-success">
                    <a href="/saleswebapp/home" class="close" data-dismiss="alert" aria-label="close" title="close">x</a>
                    <th th:text="#{home.success.restaurantChangeSuccess}" />
                </div>
            </div>

        <div class="page-header">
            <h3><th th:text="#{home.label.toDoTable.heading}" /></h3>
        </div>

        <table id="toDoTable" class="table table-striped table-bordered dataTables-scrollHead" cellspacing="0" width="100%">
            <thead>
            <tr>
                <th> <span th:text="#{home.label.toDoTable.restaurant}" /> </th>
                <th>
                    <span th:text="#{home.label.toDoTable.id}" />
                    <span class="glyphicon glyphicon-question-sign" th:title="#{restaurant.label.tooltip}" />
                </th>
                <th> <span th:text="#{home.label.toDoTable.RequestTyp}" /> </th>
                <th> <span th:text="#{home.label.toDoTable.timestamp}" /> </th>
                <th> <span th:text="#{home.label.toDoTable.read}" /> </th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="toDo : ${toDos}">
                <td> <a class="btn-link" th:href="@{/restaurant(id=${toDo.restaurantId})}" th:text="${toDo.restaurantName}" /> </td>
                <td>
                    <!-- Displays the processId(id) as a link if the requestTyp is a changeRequest -->
                    <div th:switch="${toDo.requestTyp}">
                        <span th:case="'Änderung freigeben'"> <a class="btn-link" th:href="@{/changeRequest(id=${toDo.id})}" th:text="${toDo.id}" /> </span>
                        <span th:case="'Besuchsaufforderung'"> <span th:text="${toDo.id}" /> </span>
                        <span th:case="'Umsatzwarnung'"> <span th:text="${toDo.id}" /> </span>
                    </div>
                </td>

                <td>
                    <div th:switch="${toDo.requestTyp}">
                        <span th:case="'Änderung freigeben'"> <span th:text="#{home.label.toToTable.RequestTypId1}" /> </span>
                        <span th:case="'Besuchsaufforderung'"> <span th:text="#{home.label.toToTable.RequestTypId2}" /> </span>
                        <span th:case="'Umsatzwarnung'"> <span th:text="#{home.label.toToTable.RequestTypId3}" /> </span>
                    </div>
                </td>

                <td> <span th:text="${toDo.timestamp}" /> </td>

                <td>
                    <div th:switch="${toDo.requestTyp}">
                        <span th:case="'Änderung freigeben'">  </span>
                        <span th:case="'Besuchsaufforderung'"> #deleteIcon </span>
                        <span th:case="'Umsatzwarnung'"> #deleteIcon </span>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>

        <div class="page-header">
            <h3><th th:text="#{home.label.restaurantTable.heading}" /></h3>
        </div>

        <table id="restaurantTable" class="table table-striped table-bordered dataTables-scrollHead" cellspacing="0" width="100%">
            <thead>
            <tr>
                <th> <span th:text="#{home.label.restaurantTable.name}" /> </th>
                <th> <span th:text="#{home.label.restaurantTable.email}" /> </th>
                <th> <span th:text="#{home.label.restaurantTable.phone}" /> </th>
                <th> <span th:text="#{home.label.restaurantTable.street}" /> </th>
                <th> <span th:text="#{home.label.restaurantTable.city}" /> </th>
                <th> <span th:text="#{home.label.restaurantTable.zip}" /> </th>
            </tr>
            </thead>

            <tfoot>
            <tr>
                <th> <span th:text="#{home.label.restaurantTable.name}" /> </th>
                <th> <span th:text="#{home.label.restaurantTable.email}" /> </th>
                <th> <span th:text="#{home.label.restaurantTable.phone}" /> </th>
                <th> <span th:text="#{home.label.restaurantTable.street}" /> </th>
                <th> <span th:text="#{home.label.restaurantTable.city}" /> </th>
                <th> <span th:text="#{home.label.restaurantTable.zip}" /> </th>
            </tr>
            </tfoot>

            <tbody>
            <tr th:each="restaurant : ${restaurants}">
                <td> <a class="btn-link" th:href="@{/restaurant(id=${restaurant.id})}" th:text="${restaurant.name}" /> </td>
                <td> <span th:text="${restaurant.email}" /> </td>
                <td> <span th:text="${restaurant.phone}" /> </td>
                <td> <span th:text="${restaurant.street}" /> <span th:text="${restaurant.streetNumber}" /> </td>
                <td> <span th:text="${restaurant.city}" /> </td>
                <td> <span th:text="${restaurant.zip}" /> </td>
            </tr>
            </tbody>
        </table>

        </div>

        <div th:replace="fragments/footer :: footer"></div>
    </body>

</html>





